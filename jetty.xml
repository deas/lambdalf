<?xml version="1.0"?>
<!DOCTYPE Configure PUBLIC "-//Mort Bay Consulting//DTD Configure//EN" "http://jetty.mortbay.org/configure.dtd">

<Configure id="Server" class="org.eclipse.jetty.server.Server">

    <New id="myDataSource"
         class="org.eclipse.jetty.plus.jndi.Resource">
        <Arg></Arg>
        <Arg>jdbc/dataSource</Arg>
        <Arg>
            <New class="org.h2.jdbcx.JdbcDataSource">
                <Set name="URL">jdbc:h2:target/h2_data/lambdalf;MVCC=true</Set>
                <Set name="User">alfresco</Set>
                <Set name="Password">alfresco</Set>
            </New>
        </Arg>
    </New>

    <New id="httpConfig" class="org.eclipse.jetty.server.HttpConfiguration">
        <Set name="secureScheme">https</Set>
        <Set name="securePort"><Property name="jetty.secure.port" default="8443" /></Set>
        <Set name="outputBufferSize">32768</Set>
        <Set name="requestHeaderSize">8192</Set>
        <Set name="responseHeaderSize">8192</Set>
        <Set name="sendServerVersion">true</Set>
        <Set name="sendDateHeader">false</Set>
        <Set name="headerCacheSize">512</Set>

        <!-- Uncomment to enable handling of X-Forwarded- style headers
        <Call name="addCustomizer">
          <Arg><New class="org.eclipse.jetty.server.ForwardedRequestCustomizer"/></Arg>
        </Call>
        -->
    </New>
    <Call name="addConnector">
        <Arg>
            <New class="org.eclipse.jetty.server.ServerConnector">
                <Arg name="server"><Ref id="Server" /></Arg><!--name="server" -->
                <Arg name="factories"><!-- name="factories" -->
                    <Array type="org.eclipse.jetty.server.ConnectionFactory">
                        <Item>
                            <New class="org.eclipse.jetty.server.HttpConnectionFactory">
                                <Arg name="config"><Ref id="httpConfig" /></Arg>
                            </New>
                        </Item>
                    </Array>
                </Arg>
                <Set name="host"></Set>
                <Set name="port">9090</Set>
                <!--Set name="idleTimeout">30000</Set-->
            </New>
        </Arg>
    </Call>
    <Call name="addBean">
        <Arg>
            <New class="org.eclipse.jetty.security.HashLoginService">
                <Set name="name">Repository</Set>
                <Set name="config">realm.properties</Set>
                <Set name="refreshInterval">0</Set>
                <Call name="putUser">
                    <Arg>alfresco</Arg>
                    <Arg>
                        <New class="org.eclipse.jetty.util.security.Password">
                            <Arg>alfresco</Arg>
                        </New>
                    </Arg>
                    <Arg></Arg>
                </Call>
            </New>
        </Arg>
    </Call>
</Configure>
